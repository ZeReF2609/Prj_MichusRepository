@model IEnumerable<Michus.Models.Producto>

@{
    // Check if ViewBag.Categories is null and initialize it if necessary
    var categories = ViewBag.Categories as List<SelectListItem> ?? new List<SelectListItem>();

    var avatarUrl = User.FindFirst("AvatarUrl")?.Value ?? "https://cdn-icons-png.flaticon.com/512/9385/9385289.pngg";
    var userName = User.FindFirst("UserName")?.Value ?? "Usuario";
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-success">
        @TempData["Message"]
    </div>
}

<div class="dropdown" style="position: absolute; top: 10px; right: 10px;">
    <!-- Avatar del usuario -->
    <img src="@avatarUrl" alt="User Avatar" class="avatar-img" style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer;" data-bs-toggle="dropdown" aria-expanded="false" />

    <!-- Menú desplegable -->
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="right: 0; left: auto;">
        <li><a class="dropdown-item" href="#">@userName</a></li>
        <li><hr class="dropdown-divider"></li>
        <li>
            <form action="@Url.Action("Salir", "LoginCli")" method="post">
                <button type="submit" class="dropdown-item">Logout</button>
            </form>
        </li>
    </ul>
</div>

<!-- Agregar estilo y JavaScript para mejorar la experiencia de usuario -->
<style>
    .dropdown-menu {
        min-width: 200px;
        padding: 10px;
    }

    .avatar-img {
        cursor: pointer;
    }
</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<!-- JavaScript para el funcionamiento del dropdown (con Bootstrap) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Botón de "Ver carrito" -->
<form asp-action="Cart" method="get">
    <button type="submit">Go to Cart</button>
</form>

<h2>Products</h2>

<!-- Category Filter -->
<form asp-action="ListarProductos" method="get">
    <select name="category" id="category">
        <option value="">Select Category</option>
        @foreach (var category in categories)
        {
            <option value="@category.Value">@category.Text</option>
        }
    </select>
    <button type="submit">Filter</button>
</form>

<div>
    @foreach (var product in Model)
    {
        <div>
            <h3>@product.ProdNom</h3>
            <p>@product.Descripcion</p>
            <p>Price: @product.Precio</p>
            <form asp-action="AddToCart" method="post">
                <input type="hidden" name="productId" value="@product.IdProducto" />
                <button type="submit">Add to Cart</button>
            </form>
        </div>
    }
</div>

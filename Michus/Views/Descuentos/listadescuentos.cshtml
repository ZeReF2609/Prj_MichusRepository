@model IEnumerable<Michus.Models.pa_lista_descuento_carta>

@{
    ViewData["Title"] = "Lista de Descuentos";
}

<link rel="stylesheet" href="~/assets/css/DescuentoStyle.css">

<div class="discount-manager">
    <div class="add-button-container">
        <!-- Botón para abrir el modal general -->
        <button class="add-button open-modal">+</button>
    </div>

    <h1>Gestor de Descuentos</h1>

    @using (Html.BeginForm("listadescuentos", "Descuentos", FormMethod.Get))
    {
        <div class="filters">
            @Html.DropDownList("FECHA_INICIO", (SelectList)ViewBag.AniosInicioDesc, "FECHA INICIO", new { @class = "form-select" })
            <br />
            @Html.DropDownList("FECHA_FIN", (SelectList)ViewBag.AniosFinDesc, "FECHA FIN", new { @class = "form-select" })
            <br />
            <button class="filter-button" type="submit">🔍</button>
            <br />
        </div>
    }

    <div class="discount-cards">
        @foreach (var item in Model.Select((value, index) => new { value, index }))
        {
            <div class="discount-card" data-modal-id="modal_@item.index" data-discount-details="
                    <h3>Descuento: @(item.value.TipoDescuento == 0 ? $"s/. {item.value.PrecioDescuento}" : $"{item.value.PrecioDescuento}%")</h3>
                    <p>Tipo de descuento: @(item.value.TipoDescuento == 1 ? "Descuento Fijo" : "Descuento Porcentual")</p>
                    <p>Desde: @(item.value.FechaInicio == DateTime.MinValue ? "NO APLICA" : item.value.FechaInicio.ToString("dd/MM/yyyy"))</p>
                    <p>Hasta: @(item.value.FechaFin == DateTime.MinValue ? "NO APLICA" : item.value.FechaFin.ToString("dd/MM/yyyy"))</p>
                    <p>Estado: @(item.value.Estado == 1 ? "Activo" : "Inactivo")</p>
                ">
                    <div class="discount-header">
                        <span class="discount-badge">
                        @if (item.value.TipoDescuento == 0)
                        {
                            @($"s/. {item.value.PrecioDescuento}")
                        }
                        else
                        {
                            @($"{item.value.PrecioDescuento}%")
                        }
                        </span>
                        <div class="toggle">
                            <input type="checkbox" id="btn_@item.value.IdDescuento" @(item.value.Estado == 1 ? "checked" : "")>
                            <label for="btn-@item.index"></label>
                        </div>
                    </div>

                @if (item.value.TipoDescuento == 1)
                {
                            <h2>Descuento Fijo</h2>
                }
                else
                {
                            <h2>Descuento Porcentual</h2>
                }

                    <p>Desde: @(item.value.FechaInicio == DateTime.MinValue ? "NO APLICA" : item.value.FechaInicio.ToString("dd/MM/yyyy"))</p>
                    <p>Hasta: @(item.value.FechaFin == DateTime.MinValue ? "NO APLICA" : item.value.FechaFin.ToString("dd/MM/yyyy"))</p>
                </div>
        }
    </div>
</div>

<!-- Modal flotante para agregar descuento -->
<div id="addDiscountModal" class="custom-modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Agregar Descuento</h2>
        <p>Este es un modal vacío listo para ser llenado con contenido.</p>
        <button class="save-button">Guardar Cambios</button>
    </div>
</div>

<!-- Modal flotante para mostrar detalles del descuento -->
<div id="detailsDiscountModal" class="custom-modal">
    <div class="modal-content">
        <span class="close-details-modal">&times;</span>
        <h2>Detalles del Descuento</h2>
        <div id="discount-details-content">
            <!-- Aquí se mostrarán los detalles del descuento -->
        </div>
        <button class="close-details-button">Cerrar</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Mostrar el modal de agregar descuento cuando se hace clic en el botón "+"
        document.querySelector('.open-modal').addEventListener('click', () => {
            document.getElementById('addDiscountModal').style.display = 'flex';
        });

        // Cerrar el modal de agregar descuento al hacer clic en la "x"
        document.querySelector('.close-modal').addEventListener('click', () => {
            document.getElementById('addDiscountModal').style.display = 'none';
        });

        // Mostrar el modal de detalles del descuento cuando se hace clic en un descuento
        document.querySelectorAll('.discount-card').forEach(card => {
            card.addEventListener('click', () => {
                // Obtener los detalles del descuento
                const discountDetails = card.getAttribute('data-discount-details');

                // Llenar el modal con los detalles
                document.getElementById('discount-details-content').innerHTML = discountDetails;

                // Mostrar el modal de detalles
                document.getElementById('detailsDiscountModal').style.display = 'flex';
            });
        });

        // Cerrar el modal de detalles al hacer clic en la "x"
        document.querySelector('.close-details-modal').addEventListener('click', () => {
            document.getElementById('detailsDiscountModal').style.display = 'none';
        });

        // Cerrar el modal de detalles al hacer clic en el botón "Cerrar"
        document.querySelector('.close-details-button').addEventListener('click', () => {
            document.getElementById('detailsDiscountModal').style.display = 'none';
        });
    });
</script>
